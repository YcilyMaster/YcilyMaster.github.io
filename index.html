<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timers Wakfu - Tracker</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body { background: #121212; color: #e0e0e0; min-height: 100vh; }
        .navbar { background: #1e1e2e !important; box-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .sidebar { position: fixed; top: 56px; left: 0; bottom: 0; width: 260px; background: #1e1e2e; padding: 20px 15px; border-right: 1px solid #333; overflow-y: auto; z-index: 1000; transition: all 0.3s; }
        .sidebar .category { color: #89b4fa; font-weight: bold; text-transform: uppercase; font-size: 0.9rem; margin: 20px 0 10px 0; padding-left: 10px; }
        .sidebar .nav-link { color: #cdd6f4; padding: 10px 15px; border-radius: 8px; margin: 4px 8px; display: flex; align-items: center; gap: 10px; transition: all 0.2s; }
        .sidebar .nav-link:hover, .sidebar .nav-link.active { background: #313244; color: #89b4fa; }
        .main-content { margin-left: 260px; margin-top: 56px; padding: 30px; transition: all 0.3s; }
        .monster-img { width: 70px; height: 70px; object-fit: contain; border: 2px solid #89b4fa; border-radius: 8px; }
        .table-dark { --bs-table-bg: #1e1e2e; --bs-table-hover-bg: #313244; }
        .form-control, .form-select { background-color: #1e1e2e; border-color: #444; color: #cdd6f4; }
        .form-control:focus, .form-select:focus { background-color: #1e1e2e; border-color: #89b4fa; box-shadow: 0 0 0 0.2rem rgba(137, 180, 250, 0.25); color: #cdd6f4; }
        .form-label { color: white !important; }
        .text-muted { color: white !important; }
        .form-control { color: white !important; background-color: #1e1e2e !important; border-color: #444 !important; }
        .form-control::placeholder { color: #bbbbbb !important; }
        .form-control:focus { color: white !important; background-color: #1e1e2e !important; border-color: #89b4fa !important; box-shadow: 0 0 0 0.2rem rgba(137, 180, 250, 0.25) !important; }
        @media (max-width: 992px) {
            .sidebar { left: -260px; }
            .main-content { margin-left: 0; }
            .sidebar.show { left: 0; }
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <button class="btn btn-outline-light d-lg-none me-3" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarOffcanvas">
                <i class="bi bi-list"></i>
            </button>
            <span class="navbar-brand mb-0 h5">
                <i class="bi bi-clock-history"></i> Timers Wakfu
            </span>
            <span class="badge bg-success ms-auto" id="badge-servidor">Pandora</span>
        </div>
    </nav>

    <!-- Sidebar Desktop -->
    <div class="sidebar d-none d-lg-block">
        <div class="category">Servidores Históricos</div>
        <a href="#" class="nav-link active" data-servidor="pandora"><i class="bi bi-server"></i> Pandora</a>
        <a href="#" class="nav-link" data-servidor="rubilax"><i class="bi bi-server"></i> Rubilax</a>
        <a href="#" class="nav-link" data-servidor="ogrest"><i class="bi bi-server"></i> Ogrest</a>

        <div class="category mt-4">Servidores Neo</div>
        <a href="#" class="nav-link" data-servidor="pandora-neo"><i class="bi bi-stars"></i> Pandora</a>
        <a href="#" class="nav-link" data-servidor="rubilax-neo"><i class="bi bi-stars"></i> Rubilax</a>
        <a href="#" class="nav-link" data-servidor="ogrest-neo"><i class="bi bi-stars"></i> Ogrest</a>
    </div>

    <!-- Offcanvas móvil -->
    <div class="offcanvas offcanvas-start bg-dark text-white" tabindex="-1" id="sidebarOffcanvas">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title"><i class="bi bi-server"></i> Servidores</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body px-0">
            <div class="sidebar" style="position: static; width: 100%;">
                <!-- mismo contenido que arriba -->
            </div>
        </div>
    </div>

    <!-- Contenido principal -->
    <div class="main-content">
        <h2 id="titulo-servidor">Pandora</h2>
        <p class="text-muted">Monstruos con drops raros y temporizadores</p>

        <!-- Filtros -->
        <div class="card bg-dark border-secondary mb-4">
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label"><i class="bi bi-search"></i> Buscar por nombre</label>
                        <input type="text" id="filtro-nombre" class="form-control" placeholder="Ej: Jalabujero">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label"><i class="bi bi-filter"></i> Nivel</label>
                        <input type="text" id="filtro-nivel" class="form-control" placeholder="Ej: 23 o 50-60">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label"><i class="bi bi-geo-alt"></i> Lugar</label>
                        <input type="text" id="filtro-lugar" class="form-control" placeholder="Ej: Tainela">
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button id="btn-limpiar" class="btn btn-outline-danger w-100">
                            <i class="bi bi-eraser"></i> Limpiar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabla -->
        <div class="table-responsive">
            <table class="table table-dark table-hover align-middle">
                <thead class="table-primary text-dark">
                    <tr>
                        <th>Monstruo</th>
                        <th>Drops</th>
                        <th>Nivel</th>
                        <th>Lugar</th>
                        <th class="text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tabla-monstruos"></tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let servidorActual = "pandora";
        let monstruosActuales = [];

        async function cargarServidor(nombre) {
            try {
                const resp = await fetch(`${nombre}.json`);
                if (resp.ok) {
                    monstruosActuales = await resp.json();
                } else {
                    monstruosActuales = [];
                }
            } catch (e) {
                console.warn(`Archivo ${nombre}.json no encontrado`);
                monstruosActuales = [];
            }
            renderTabla(monstruosActuales);
            aplicarFiltros(); // si tienes filtros
        }

        // Al hacer clic en un servidor del sidebar:
        document.querySelectorAll(".nav-link[data-servidor]").forEach(link => {
            link.addEventListener("click", async (e) => {
                e.preventDefault();
                // ... código de activar el link ...
                servidorActual = link.dataset.servidor;
                await cargarServidor(servidorActual); // ← aquí carga el JSON
                // actualizar título, badge, etc.
            });
        });

        function renderTabla(data) {
            const tbody = document.getElementById("tabla-monstruos");
            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="text-center py-4 text-muted">No se encontraron monstruos con los filtros aplicados</td></tr>`;
                return;
            }

            tbody.innerHTML = data.map((m, i) => `
                <tr>
                    <td><img src="${m.imagen}" class="monster-img" alt="${m.nombre}"></td>
                    <td>
                        <a href="${m.drops}" target="_blank" class="text-info text-decoration-none fw-bold">
                            ${m.nombre} <i class="bi bi-box-arrow-up-right small"></i>
                        </a>
                    </td>
                    <td>${m.nivel}</td>
                    <td>${m.lugar}</td>
                    <td class="text-center">
                        <button class="btn btn-outline-warning btn-sm" title="Editar"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-outline-success btn-sm ms-1" title="Marcar hecho"><i class="bi bi-check2"></i></button>
                        <button class="btn btn-outline-danger btn-sm ms-1" title="Eliminar"><i class="bi bi-trash"></i></button>
                    </td>
                </tr>
            `).join("");
        }

        // Filtros en tiempo real
        function aplicarFiltros() {
            const filtroNombre = document.getElementById("filtro-nombre").value.toLowerCase().trim();
            const filtroNivel = document.getElementById("filtro-nivel").value.toLowerCase().trim();
            const filtroLugar = document.getElementById("filtro-lugar").value.toLowerCase().trim();

            const filtrados = monstruosActuales.filter(m => {
                const matchNombre = m.nombre.toLowerCase().includes(filtroNombre);
                const matchNivel = m.nivel.toLowerCase().includes(filtroNivel);
                const matchLugar = m.lugar.toLowerCase().includes(filtroLugar);
                return matchNombre && matchNivel && matchLugar;
            });

            renderTabla(filtrados);
        }

        // Eventos de filtros
        document.getElementById("filtro-nombre").addEventListener("input", aplicarFiltros);
        document.getElementById("filtro-nivel").addEventListener("input", aplicarFiltros);
        document.getElementById("filtro-lugar").addEventListener("input", aplicarFiltros);

        // Botón limpiar
        document.getElementById("btn-limpiar").addEventListener("click", () => {
            document.getElementById("filtro-nombre").value = "";
            document.getElementById("filtro-nivel").value = "";
            document.getElementById("filtro-lugar").value = "";
            renderTabla();
        });

        // Cambiar servidor
        document.querySelectorAll(".nav-link[data-servidor]").forEach(link => {
            link.addEventListener("click", (e) => {
                e.preventDefault();
                document.querySelectorAll(".nav-link").forEach(l => l.classList.remove("active"));
                link.classList.add("active");

                servidorActual = link.dataset.servidor;
                const nombreServidor = link.textContent.trim();
                document.getElementById("titulo-servidor").textContent = nombreServidor;
                document.getElementById("badge-servidor").textContent = nombreServidor;

                // Reiniciar filtros al cambiar de servidor
                document.getElementById("filtro-nombre").value = "";
                document.getElementById("filtro-nivel").value = "";
                document.getElementById("filtro-lugar").value = "";

                renderTabla(); // vuelve a mostrar todos
                aplicarFiltros(); // aplica por si había algo escrito (no debería)
            });
        });

        // Carga inicial
        cargarServidor(servidorActual);
    </script>
</body>
</html>